# coding: utf8

import httplib2

headers = {"Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
               "Connection": "keep-alive",
               "User-Agent": 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:52.0) Gecko/20100101 Firefox/52.0'}


def detect(ip, port):
    url = "{0}:{1}".format(ip, port)
    url_7504 = url + '/jbossmq-httpil/HTTPServerILServlet'
    http = httplib2.Http()
    content = http.request('GET', url_7504, redirect=False, headers=headers)[1]
    if 'JBossMQ HTTP-IL' in content:
       print ip + ':' + port + ' 存在CVE-2015-7504漏洞'

    url_7501 = url + '/invoker/JMXInvokerServlet'
    res = http.request('GET', url_7501, redirect=False, headers=headers)[0]
    if 'x-java-serialized-object' in res:
        print ip + ':' + port + ' 存在CVE-2015-7501漏洞'

    url_4810 = url + '/web-console/Invoker'
    res = http.request('GET', url_4810, redirect=False, headers=headers)[0]
    if 'x-java-serialized-object' in res:
        print ip + ':' + port + ' 存在CVE-2013-4810漏洞'